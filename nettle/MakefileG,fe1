# gcc / NetLib Makefile for Nettle
# by A. Macfarlane Smith
# (C) Archifishal Software 2001

CC = gcc
CFLAGS = -c -INetlib: -mstubs -mthrowback -O2 -Wall -Wno-unknown-pragmas -DFORTIFY
# -mamu : generate !Depend file - only useful with AMU

LINK = gcc
LINKFLAGS = -mstubs -debug

WIPE = wipe
WIPEFLAGS = ~CFR~V

OBJASM = gcc
OBJASMFLAGS = -c

OBJS = o.chardefn o.choices o.globals o.init o.lineedit o.main o.misc \
       o.nettle o.process o.socket o.quit o.seln o.wimp o.zapgen o.fortify

RUNIMAGE = !Nettle.!RunImage

all: $(RUNIMAGE)

$(RUNIMAGE): $(OBJS)
	$(LINK) $(LINKFLAGS) NetLib:o.NetLib $(OBJS) -o $(RUNIMAGE)

clean:
	$(WIPE) o.* $(WIPEFLAGS)

.SUFFIXES: .o .s .c

.s.o:
	$(ASM) $(ASMFLAGS) $< -o $@

.c.o:
	$(CC) $(CFLAGS) -o $@ $<


o.chardefn:	c.chardefn h.generic h.globals h.chardefn h.misc
o.choices:	c.choices h.generic h.globals h.choices h.misc
o.fortify:	c.fortify h.fortify h.ufortify
o.globals:	c.globals h.generic h.globals h.zapredraw
o.init:		c.init h.generic h.globals h.chardefn h.init h.misc \
		h.nettle h.quit h.wimp h.zapredraw
o.lineedit:	c.lineedit h.generic h.globals h.lineedit h.misc h.wimp
o.main:		c.main h.generic h.globals h.choices h.init h.main h.misc \
		h.quit h.wimp
o.misc:		c.misc h.generic h.globals h.misc
o.nettle:	c.nettle h.generic h.globals h.misc h.nettle h.seln h.socket \
                h.wimp h.zapredraw
o.process:	c.process h.generic h.globals h.graphics h.misc h.nettle \
                h.process h.seln h.wimp h.zapredraw
o.quit:		c.quit h.generic h.globals h.misc h.nettle h.quit
o.seln:		c.seln h.generic h.globals h.nettle h.seln h.wimp h.zapredraw
o.socket:	c.socket h.generic h.globals h.socket
o.wimp:		c.wimp h.generic h.globals h.misc h.nettle h.process h.seln \
		h.socket h.wimp h.zapredraw
o.zapgen:	s.zapgengc
		$(OBJASM) $(OBJASMFLAGS) s.zapgengc -o o.zapgen
