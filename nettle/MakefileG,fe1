# gcc / NetLib Makefile for Nettle
# (C) Nettle developers 2000-2001
#
# $Id$

ifeq (${lib},scl)
SCLIB=-mlibscl
SCINC=-INetlib:
SCLINK=NetLib:o.NetLib
endif

CC = gcc
CFLAGS = -v -c $(SCINC) $(SCLIB) -mthrowback -O2 -Wall -Wno-unknown-pragmas \
   -Wshadow -Wundef -Wpointer-arith -Wcast-align -Wwrite-strings \
   -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations \
   -Wnested-externs -Wcast-qual -DFORTIFY
# -mamu : generate !Depend file - only useful with AMU

LINK = gcc
LINKFLAGS = $(SCLIB) -debug

WIPE = wipe
WIPEFLAGS = ~CFR~V

OBJASM = gcc
OBJASMFLAGS = -c

TEMPLATES = !Nettle.Resources.UK.Template3D

OBJS = chardefn.o choices.o globals.o init.o keyboard.o lineedit.o main.o misc.o hotlist.o \
       nettle.o process.o socket.o quit.o seln.o wimp.o zapgen.o fortify.o sockwatch.o \
       messages.o termlist.o

RUNIMAGE = !Nettle.!RunImage

all: $(RUNIMAGE)

$(RUNIMAGE): $(OBJS)
	$(LINK) $(LINKFLAGS) $(SCLINK) $(OBJS) -o $(RUNIMAGE)

templheadr: templheadr.o
        $(LINK) $(LINKFLAGS) $(SCLINK) $? -o $@

clean:
	$(WIPE) o.* $(WIPEFLAGS)

templ.h: templheadr $(TEMPLATES)
	<Obey$Dir>.templheadr $(TEMPLATES) $@

.SUFFIXES: .o .s .c

.c.o:
	$(CC) $(CFLAGS) -o $@ $<

.s.o:
	$(OBJASM) $(OBJASMFLAGS) $< -o $@ 


hotlist.o:      hotlist.c hotlist.h generic.h globals.h misc.h nettle.h wimp.h
chardefn.o:	chardefn.c generic.h globals.h chardefn.h misc.h
choices.o:	choices.c generic.h globals.h choices.h misc.h wimp.h
fortify.o:	fortify.c fortify.h ufortify.h
globals.o:	globals.c generic.h globals.h zapredraw.h
init.o: 	init.c generic.h globals.h chardefn.h init.h misc.h \
              	nettle.h quit.h wimp.h zapredraw.h templ.h
lineedit.o:   	lineedit.c generic.h globals.h lineedit.h misc.h wimp.h
main.o: 	main.c generic.h globals.h choices.h init.h main.h misc.h \
              	quit.h wimp.h hotlist.h
misc.o: 	misc.c generic.h globals.h misc.h
nettle.o:	nettle.h generic.h globals.h misc.h nettle.h seln.h socket.h \
	      	wimp.h zapredraw.h
process.o:	process.h generic.h globals.h graphics.h misc.h nettle.h \
		keyboard.h seln.h wimp.h zapredraw.h
quit.o: 	quit.c generic.h globals.h misc.h nettle.h quit.h hotlist.h
seln.o: 	seln.c generic.h globals.h nettle.h seln.h wimp.h zapredraw.h
socket.o:	socket.c generic.h globals.h sockwatch.h socket.h
wimp.o: 	wimp.c generic.h globals.h lineedit.h misc.h nettle.h process.h \
		seln.h socket.h wimp.h zapredraw.h hotlist.h termlist.h \
		choices.h templ.h
zapgen.o:    	zapgen.c generic.h globals.h nettle.h
messages.o:     messages.c messages.h generic.h globals.h misc.h
sockwatch.o:	sockwatch.c sockwatch.h
termlist.o:	termlist.c generic.h globals.h termlist.h misc.h nettle.h wimp.h
