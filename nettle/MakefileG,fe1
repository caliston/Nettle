# gcc / NetLib Makefile for Nettle
# by A. Macfarlane Smith
# (C) Archifishal Software 2001

ifeq (${lib},scl)
SCLIB=-mlibscl
SCINC=-INetlib:
SCLINK=NetLib:o.NetLib
endif

CC = gcc
CFLAGS = -c $(SCINC) $(SCLIB) -mthrowback -O2 -Wall -Wno-unknown-pragmas \
  -DFORTIFY
# -mamu : generate !Depend file - only useful with AMU

LINK = gcc
LINKFLAGS = $(SCLIB) -debug

WIPE = wipe
WIPEFLAGS = ~CFR~V

OBJASM = gcc
OBJASMFLAGS = -c

OBJS = chardefn.o choices.o globals.o init.o lineedit.o main.o misc.o \
       nettle.o process.o socket.o quit.o seln.o wimp.o zapgen.o fortify.o

RUNIMAGE = !Nettle.!RunImage

all: $(RUNIMAGE)

$(RUNIMAGE): $(OBJS)
	$(LINK) $(LINKFLAGS) $(SCLINK) $(OBJS) -o $(RUNIMAGE)

clean:
	$(WIPE) o.* $(WIPEFLAGS)

.SUFFIXES: .o .s .c

.c.o:
	$(CC) $(CFLAGS) -o $@ $<


chardefn.o:	chardefn.c generic.h globals.h chardefn.h misc.h
choices.o:	choices.c generic.h globals.h choices.h misc.h
fortify.o:	fortify.c fortify.h ufortify.h
globals.o:	globals.c generic.h globals.h zapredraw.h
init.o: 	init.c generic.h globals.h chardefn.h init.h misc.h \
              	nettle.h quit.h wimp.h zapredraw.h
lineedit.o:   	lineedit.c generic.h globals.h lineedit.h misc.h wimp.h
main.o: 	main.c generic.h globals.h choices.h init.h main.h misc.h \
              	quit.h wimp.h
misc.o: 	misc.c generic.h globals.h misc.h
nettle.o:	nettle.h generic.h globals.h misc.h nettle.h seln.h socket.h \
	      	wimp.h zapredraw.h
process.o:	process.h generic.h globals.h graphics.h misc.h nettle.h \
		process.h seln.h wimp.h zapredraw.h
quit.o: 	quit.c generic.h globals.h misc.h nettle.h quit.h
seln.o: 	seln.c generic.h globals.h nettle.h seln.h wimp.h zapredraw.h
socket.o:	socket.c generic.h globals.h socket.h
wimp.o: 	wimp.c generic.h globals.h misc.h nettle.h process.h seln.h \
              	socket.h wimp.h zapredraw.h
zapgen.o:    	zapgengc.s
		$(OBJASM) $(OBJASMFLAGS) zapgengc.s -o zapgen.o
