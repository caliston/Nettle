/**
 * Closedown code
 * (C) Nettle developers 2000-2001
 *
 * $Id$
 */

#include "generic.h"
#include "globals.h"

#include "misc.h"
#include "nettle.h"
#include "quit.h"

void closedown_wimp(void)
{
  _swi(Wimp_CloseDown, _INR(0,1), task_handle, 0x4b534154);
}

void closedown_application(void)
{
  /* Quit! */

  while (sessions)
  {
    remove_session(sessions);
  }

  _swi(MessageTrans_CloseFile, _IN(0), messagetrans_area);

  switch (dynamic_areas_available())
  {
    case true:
      if (bitmaps_area_number!=0)
      {
        _swi(OS_DynamicArea, _INR(0,1), 1, bitmaps_area_number);
      }
      break;
    case false:
      free(bitmaps_area);
      break;
  }

  free(messagetrans_buffer);
  free(sprite_area);
  free(zap_font_area);
  free(zap_lowres_font_area);
  free(zapredraw_area);

  close_log();

#ifdef FORTIFY
  Fortify_LeaveScope();
#endif

  closedown_wimp();

  exit(EXIT_SUCCESS);
}
