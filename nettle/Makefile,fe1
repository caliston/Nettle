# Acorn / NetLib Makefile for Nettle
# by A. Macfarlane Smith
# (C) Archifishal Software 2001
#
# $Id$


# Uncomment /these/ to use NetLib
NETINCLUDE = NetLib:
NETLIBS    = NetLib:o.netlib
NETLIBFLAG = 

# Uncomment /these/ to use TCPIPLibs
#NETINCLUDE = TCPIPLibs:
#NETLIBS    = TCPIPLibs:o.socklib TCPIPLIBS:o.inetlib
#NETLIBFLAG = -DUSE_TCPIPLIB


CC = cc
CFLAGS = -c -strict -IC: -I$(NETINCLUDE) -fa -apcs 3/26 -throwback -depend !Depend $(NETLIBFLAG) -DBETA_VERSION #-g #-DFORTIFY

LINK = link
LINKFLAGS = #-d

MKDIR = cdir

WIPE = wipe
WIPEFLAGS = ~CFR~V

ASM = objasm
ASMFLAGS = -apcs 3/26

TEMPLATES = !Nettle.Resources.UK.Templates

OBJS = chardefn.o choices.o dnslib.o globals.o init.o keyboard.o lineedit.o \
       main.o misc.o hotlist.o nettle.o process.o socket.o quit.o seln.o \
       wimp.o zapgen.o fortify.o sockwatch.o messages.o termlist.o url.o \
       wimputil.o spool.o mouse.o scripts.o processesc.o processiac.o \
       procesescx.o

all:	!Nettle.!RunImage

templheadr: templheadr.o
        $(LINK) -o $@ $(LINKFLAGS) $? C:o.stubs

!Nettle.!RunImage:	$(OBJS)
	$(LINK) -o $@ $(LINKFLAGS) $(OBJS) C:o.stubs $(NETLIBS)
	|squeeze $@

clean:
	$(WIPE) o.* $(WIPEFLAGS)

templ.h: templheadr $(TEMPLATES)
	If "<Prefix$Dir>" <> "" Then /<Prefix$Dir>.templheadr $(TEMPLATES) $@
	If "<Prefix$Dir>" = ""  Then /templheadr $(TEMPLATES) $@

.SUFFIXES: .o .s .c

.s.o:
	$(ASM) $(ASMFLAGS) $< -o $@

.c.o:
	$(CC) $(CFLAGS) -o $@ $<

o.wimp: templ.h
o.spool: templ.h

# Dynamic dependencies:
