# linux crossbuild gcc / NetLib Makefile for Nettle
# (C) Nettle developers 2000-2001
#
# $Id$

ifeq (${LIB},scl)
LIBFLAGS   = -mlibscl -I$(NETLIB)
EXTRALIBS  = $(NETLIB)/o/NetLib,ffd
endif


CC = $(GCCDIR)/cross/bin/gcc
CFLAGS = -c -mapcs -Wall -Wno-unknown-pragmas -Wshadow -Wundef \
   -Wpointer-arith -Wcast-align -Wwrite-strings -Wstrict-prototypes \
   -Wmissing-prototypes -Wmissing-declarations -Wnested-externs \
   -Wcast-qual -DFORTIFY $(LIBFLAGS) -O3
# -mamu : generate !Depend file - only useful with AMU

LINK = $(CC)
LINKFLAGS = -debug $(LIBFLAGS) $(EXTRALIBS)

WIPE = rm
WIPEFLAGS = -rf

ASM = $(CC)
ASMFLAGS = -c

TEMPLATES = !Nettle/Resources/UK/Templates,fec

OBJS = chardefn.o choices.o dnslib.o globals.o init.o keyboard.o lineedit.o \
       main.o misc.o hotlist.o nettle.o process.o socket.o quit.o seln.o \
       wimp.o zapgen.o fortify.o sockwatch.o messages.o termlist.o \
       wimputil.o url.o spool.o

RUNIMAGE = !Nettle/!RunImage,ff8

all: $(RUNIMAGE)

$(RUNIMAGE): $(OBJS)
	@echo "### Linking $@..."
	@$(LINK) $(LINKFLAGS) $(OBJS) -o $@

templheadr: templheadr.o
	@echo "*** Using native compiler to make templheadr tool..."
	@cc -c -Wall -O2 -o templheadr.o templheadr.c
	@cc $? -o $@

clean:
	$(WIPE) $(WIPEFLAGS) *.o 

templ.h: templheadr $(TEMPLATES)
	@./templheadr $(TEMPLATES) $@

.SUFFIXES: .o .s .c

.s.o:
	@echo "### Assembling $<..."
	@$(ASM) $(ASMFLAGS) $< -o $@

.c.o:
	@echo "### Compiling $<..."
	@$(CC) $(CFLAGS) -o $@ $<


hotlist.o:      hotlist.c hotlist.h generic.h globals.h misc.h nettle.h wimp.h \
                wimputil.o
chardefn.o:	chardefn.c generic.h globals.h chardefn.h misc.h
choices.o:	choices.c generic.h globals.h choices.h misc.h wimp.h wimputil.h \
                templ.h zapredraw.h
fortify.o:	fortify.c fortify.h ufortify.h
globals.o:	globals.c generic.h globals.h zapredraw.h
init.o: 	init.c generic.h globals.h chardefn.h init.h misc.h \
              	nettle.h quit.h wimp.h zapredraw.h templ.h wimputil.h
lineedit.o:   	lineedit.c generic.h globals.h lineedit.h misc.h wimp.h wimputil.h
main.o: 	main.c generic.h globals.h choices.h init.h main.h misc.h \
              	quit.h wimp.h hotlist.h
misc.o: 	misc.c generic.h globals.h misc.h
nettle.o:	nettle.h generic.h globals.h misc.h nettle.h seln.h socket.h \
	      	wimp.h zapredraw.h wimputil.h
process.o:	process.h generic.h globals.h graphics.h misc.h nettle.h \
		keyboard.h seln.h wimp.h zapredraw.h wimputil.h
quit.o: 	quit.c generic.h globals.h misc.h nettle.h quit.h hotlist.h
seln.o: 	seln.c generic.h globals.h nettle.h seln.h wimp.h zapredraw.h \
                wimputil.h
socket.o:	socket.c generic.h globals.h sockwatch.h socket.h
wimp.o: 	wimp.c generic.h globals.h lineedit.h misc.h nettle.h process.h \
		seln.h socket.h wimp.h zapredraw.h hotlist.h termlist.h \
		choices.h templ.h wimputil.h
zapgen.o:    	zapgen.c generic.h globals.h nettle.h wimputil.h
messages.o:     messages.c messages.h generic.h globals.h misc.h
sockwatch.o:	sockwatch.c sockwatch.h
termlist.o:	termlist.c generic.h globals.h termlist.h misc.h nettle.h wimp.h
wimputil.o:     wimputil.h wimp.h globals.h generic.h nettle.h messages.h misc.h
url.o:          generic.h globals.h url.h wimp.h wimputil.h
