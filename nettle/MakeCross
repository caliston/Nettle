# linux crossbuild gcc / NetLib Makefile for Nettle
# (C) Nettle developers 2000-2001
#
# $Id$

ifeq (${LIB},scl)
LIBFLAGS   = -mlibscl -I$(NETLIB)
EXTRALIBS  = $(NETLIB)/o/NetLib,ffd
endif


CC = $(GCCDIR)/cross/bin/gcc
CFLAGS = -c -mapcs -Wall -Wno-unknown-pragmas -Wshadow -Wundef \
   -Wpointer-arith -Wcast-align -Wwrite-strings -Wstrict-prototypes \
   -Wmissing-prototypes -Wmissing-declarations -Wnested-externs \
   -Wcast-qual -mpoke-function-name $(LIBFLAGS) -O3 # -DFORTIFY
# -mamu : generate !Depend file - only useful with AMU

LINK = $(CC)
LINKFLAGS = -debug $(LIBFLAGS) $(EXTRALIBS)

WIPE = rm
WIPEFLAGS = -rf

ASM = $(CC)
ASMFLAGS = -c

TEMPLATES = !Nettle/Resources/UK/Templates,fec

OBJS = chardefn.o choices.o dnslib.o fortify.o globals.o hotlist.o init.o \
       keyboard.o lineedit.o main.o messages.o  misc.o mouse.o nettle.o \
       process.o quit.o seln.o socket.o spool.o sockwatch.o termlist.o \
       url.o  wimputil.o wimp.o zapgen.o scripts.o

RUNIMAGE = !Nettle/!RunImage,ff8

all: $(RUNIMAGE)

$(RUNIMAGE): $(OBJS)
	@echo "### Linking $@..."
	@$(LINK) $(LINKFLAGS) $(OBJS) -o $@

templheadr: templheadr.o
	@echo "*** Using native compiler to make templheadr tool..."
	@cc -c -Wall -O2 -o templheadr.o templheadr.c
	@cc $? -o $@

clean:
	$(WIPE) $(WIPEFLAGS) *.o 

templ.h: templheadr $(TEMPLATES)
	@./templheadr $(TEMPLATES) $@

.SUFFIXES: .o .s .c

.s.o:
	@echo "### Assembling $<..."
	@$(ASM) $(ASMFLAGS) $< -o $@

.c.o:
	@echo "### Compiling $<..."
	@$(CC) $(CFLAGS) -o $@ $<


hotlist.o:      hotlist.c hotlist.h generic.h globals.h misc.h nettle.h wimp.h \
                wimputil.h
chardefn.o:	chardefn.c generic.h globals.h chardefn.h misc.h
choices.o:	choices.c generic.h globals.h choices.h misc.h wimp.h \
		wimputil.h templ.h zapredraw.h
fortify.o:	fortify.c fortify.h ufortify.h
globals.o:	globals.c generic.h globals.h zapredraw.h
init.o: 	init.c generic.h globals.h chardefn.h init.h misc.h \
              	nettle.h quit.h wimp.h zapredraw.h templ.h wimputil.h
lineedit.o:   	lineedit.c generic.h globals.h lineedit.h misc.h wimp.h \
		wimputil.h
main.o: 	main.c generic.h globals.h choices.h init.h main.h misc.h \
              	quit.h wimp.h hotlist.h
misc.o: 	misc.c generic.h globals.h misc.h
mouse.o:	mouse.c generic.h globals.h main.h mouse.h nettle.h wimputil.h \
		zapredraw.h
nettle.o:	nettle.c nettle.h generic.h globals.h misc.h nettle.h seln.h \
		socket.h wimp.h zapredraw.h wimputil.h
process.o:	process.c process.h generic.h globals.h graphics.h misc.h \
		nettle.h keyboard.h seln.h wimp.h zapredraw.h wimputil.h
quit.o: 	quit.c generic.h globals.h misc.h nettle.h quit.h hotlist.h
seln.o: 	seln.c generic.h globals.h nettle.h seln.h wimp.h zapredraw.h \
                wimputil.h
socket.o:	socket.c generic.h globals.h sockwatch.h socket.h
spool.o:	spool.c generic.h globals.h misc.h spool.h templ.h wimputil.h
wimp.o: 	wimp.c generic.h globals.h lineedit.h misc.h nettle.h \
		process.h seln.h socket.h wimp.h zapredraw.h hotlist.h \
		termlist.h choices.h templ.h wimputil.h
zapgen.o:    	zapgen.c generic.h globals.h nettle.h wimputil.h
messages.o:     messages.c messages.h generic.h globals.h misc.h
sockwatch.o:	sockwatch.c sockwatch.h
termlist.o:	termlist.c generic.h globals.h termlist.h misc.h nettle.h wimp.h
wimputil.o:     wimputil.c wimputil.h wimp.h globals.h generic.h nettle.h \
		messages.h misc.h
scripts.o:	scripts.c generic.h globals.h misc.h scripts.h wimputil.h
